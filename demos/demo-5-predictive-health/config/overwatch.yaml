# OpenGSLB Demo 5: Overwatch Configuration
#
# This overwatch node receives gossip from agents (including predictive signals),
# performs external validation, and serves DNS.
#
# Key features demonstrated:
# - Predictive health signals from agents trigger proactive draining
# - External validation confirms or overrides agent claims
# - DNS automatically excludes draining/unhealthy backends

mode: overwatch

# DNS Server Configuration
dns:
  listen_address: "0.0.0.0:53"
  zones:
    - demo.local
  default_ttl: 5  # Low TTL for demo visibility

# Overwatch-specific configuration
overwatch:
  identity:
    node_id: demo5-overwatch
    region: demo

  # Gossip - receive health updates and predictive signals from agents
  gossip:
    bind_address: "0.0.0.0:7946"
    encryption_key: "cGFzc3dvcmQxMjM0NTY3ODkwMTIzNDU2Nzg5MDEyMzQ="

  # External validation as safety net
  # "Trust but verify" - agent claims are validated externally
  validation:
    enabled: true
    check_interval: 5s
    check_timeout: 2s

  # Stale backend handling
  stale:
    threshold: 15s
    remove_after: 60s

  # DNSSEC disabled for simplicity in demo
  dnssec:
    enabled: false
    security_acknowledgment: "I understand that disabling DNSSEC removes cryptographic verification of DNS responses"

  data_dir: /var/lib/opengslb

# Region with backend servers (static configuration for DNS)
# Health status comes from agents via gossip AND external validation
regions:
  - name: demo
    servers:
      - address: 10.50.0.21
        port: 8080
        weight: 100
      - address: 10.50.0.22
        port: 8080
        weight: 100
      - address: 10.50.0.23
        port: 8080
        weight: 100
    health_check:
      type: http
      path: /health
      interval: 5s
      timeout: 2s
      failure_threshold: 2
      success_threshold: 1

# Domain routing configuration
domains:
  - name: app.demo.local
    routing_algorithm: round-robin
    regions:
      - demo
    ttl: 5  # Low TTL so DNS changes are visible quickly

# API Server
api:
  enabled: true
  address: "0.0.0.0:8080"
  allowed_networks:
    - 0.0.0.0/0  # Allow all IPv4 for demo - NOT for production!
    - "::/0"     # Allow all IPv6 for demo - NOT for production!
  trust_proxy_headers: false

# Metrics Server
metrics:
  enabled: true
  address: "0.0.0.0:9090"

# Logging
logging:
  level: debug
  format: text
